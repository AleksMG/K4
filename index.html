<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vigenère Cipher Expert</title>
    <meta name="description" content="Advanced Vigenère cipher analysis tool with frequency analysis and Kasiski examination">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Подключение зависимостей в правильном порядке -->
    <script src="dictionary.js"></script>
    <script src="vigenere.js"></script>
    <script src="worker.js"></script>

    <style>
        /* Все стили из второй версии */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --error: #e74c3c;
            --warning: #f39c12;
            --success: #2ecc71;
            --info-bg: #eaf2f8;
            --success-bg: #e8f5e9;
            --warning-bg: #fff8e1;
            --error-bg: #ffebee;
        }
        /* ... остальные стили ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>Vigenère Cipher Expert</h1>
        <p class="info">Professional-grade cipher analysis tool with frequency analysis, Kasiski examination, and dictionary attacks.</p>
        
        <!-- Все элементы интерфейса из второй версии -->
        <div class="container">
            <h2>Input</h2>
            <h3>Ciphertext <span class="tooltip">(?)<span class="tooltiptext">Enter the encrypted text you want to analyze or decrypt</span></span></h3>
            <textarea id="ciphertext" placeholder="Enter encrypted text here..."></textarea>
            
            <h3>Known Plaintext (Optional) <span class="tooltip">(?)<span class="tooltiptext">If you know part of the original text, enter it here to help find the key</span></span></h3>
            <textarea id="knownPlaintext" placeholder="Enter known text fragment if available..."></textarea>
        </div>

        <div class="container">
            <h2>Configuration</h2>
            <h3>Key <span class="tooltip">(?)<span class="tooltiptext">Enter the encryption key or leave blank for automatic detection</span></span></h3>
            <textarea id="key" placeholder="Enter key or it will be calculated automatically..."></textarea>
            
            <h3>Alphabet Configuration <span class="tooltip">(?)<span class="tooltiptext">Modify this for non-English alphabets (no duplicates allowed)</span></span></h3>
            <textarea id="alphabet">ABCDEFGHIJKLMNOPQRSTUVWXYZ</textarea>
            
            <div class="info">
                <strong>Note:</strong> For non-English alphabets, modify the character set above. Minimum 10 unique characters required.
            </div>
        </div>

        <div class="container">
            <h2>Actions</h2>
            <div class="btn-group">
                <button class="btn-primary" onclick="CipherEngine.encrypt()">Encrypt</button>
                <button class="btn-primary" onclick="CipherEngine.decrypt()">Decrypt</button>
                <button class="btn-primary" onclick="CipherEngine.analyze()">Analyze Known Text</button>
                <button class="btn-warning" onclick="CipherEngine.autoCrack()">Auto Crack (Advanced)</button>
                <button class="btn-danger" id="cancelBtn" style="display:none" onclick="CipherEngine.cancelAnalysis()">Cancel</button>
            </div>
            
            <!-- Прогресс-бар из первой версии -->
            <div id="progressContainer">
                <div id="progressBar" style="width: 0%"></div>
            </div>
            <div id="status"></div>
        </div>

        <div class="container">
            <h2>Results</h2>
            <h3>Decrypted Text</h3>
            <textarea id="plaintext" readonly></textarea>
            
            <h3>Frequency Analysis <span class="tooltip">(?)<span class="tooltiptext">Shows character distribution in decrypted text compared to English frequencies</span></span></h3>
            <canvas id="frequencyChart"></canvas>
        </div>
    </div>

    <!-- Скрипт проверки подключения -->
    <script>
        // Проверка наличия всех зависимостей
        document.addEventListener('DOMContentLoaded', () => {
            try {
                console.log("Dictionary check:", 
                    CommonWords.length > 0,
                    FrequencyDictionary.ENGLISH !== undefined,
                    KeyPatterns.COMMON !== undefined
                );
                
                if(!window.CipherEngine) {
                    throw new Error("CipherEngine not found! Check vigenere.js");
                }
            } catch(e) {
                console.error("Dependency error:", e);
                alert("Error loading dependencies: " + e.message);
            }
        });
    </script>
</body>
</html>
